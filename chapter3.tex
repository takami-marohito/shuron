本章では，従来手法及び提案手法について述べる。

\section{使用データ}\label{30}
HSI値を求めるためには海洋環境変数データ、対象魚種の漁獲実績データが必要となる。
本研究で使用したこれらのデータについて述べる。

\subsection{海洋環境変数データ}
本研究で使用する海洋環境変数データは、気象庁気象研究所で開発された海洋データ同化システムで作成されたMOVE（MRI Multivariate Ocean Variational Estimation）データである。
この海洋データ同化システムは数値海洋モデル及び同化システムから成るシステムである\cite{a5}。
\if
海洋環境変数データの説明
変数が5種
深さは54段階
格子の縦横
データがカバーする緯度範囲経度範囲
いつだれがどんな計算機で計算したか
\fi

\subsection{過去のデータの計算}
本研究では過去の海洋環境変数を利用することを提案している。
ある地点での漁獲を過去の海洋環境変数から説明する場合、その地点の海水がどこから来たものなのか計算する必要がある。
\if0
双見君の研究でその必要性を説明している
\fi
本研究で使用する海洋環境データは3次元方向の速度も含んでいるので、海水を遡って計算することができる。
そして深さごとに異なる速度を持っているので、それぞれの深さをスタート地点として遡ると全く別の地点にたどり着く。
\if0
moveデータのダウンロードの仕様（日にちと深さを指定する）を説明して、遡るために何度もダウンロードする必要があることと、そのために事前計算とするひつようがあることをせつめいする。
\fi
今回はより正確に遡るために４次のルンゲクッタ法を用いた。
\if0
ルンゲクッタ法の説明
\fi

\subsection{漁獲実績データ}
本研究で使用する漁獲実績データは、日本近海の太平洋沖におけるアカイカの漁獲実績データある。
漁獲実績データには日付、緯度、経度、漁獲量、操業開始時間、操業終了時間、CPUE（Catch Per Unit Effort）値が記録されている。
CPUE値は単位釣り機が単位時間に捕獲したアカイカの量を表している。
すべての漁船に搭載される釣り機が同じ性能であるとすると、CPUE値はその海域での魚群の密度を反映する値であるとできる。
このことから、CPUE値は漁場予測において重要な値である。
また、この漁獲実績データは、HSIモデリング結果を可視化する際に漁を行った地点をマーキングするためにも使用する。
例えば、太平洋の漁獲実績を基に日本海での漁獲量を予測しようとしても、それぞれの漁獲に関連がないので、有効な予測をすることはできない。
漁を行った地点をマーキングすることで、HSIモデリングの有効な範囲を大まかに把握することができる。

\section{HSIモデルの導出}
HSI（Habitat Suitability Index）モデルとは、対象生物の生息地としての適性を数値化するモデルであり、\cite{a2}各環境変数から算出される。
HSIは一般に、単一の環境変数から算出されるSI（Suitability Index）を統合した値として計算される。
その統合手法には主に、算術平均法，幾何平均法，限定要因法，加算要因法がある。
Tianらは同じくアカイカを対象としたHSIモデルを構築したが、その際に幾何平均法を用いている\cite{a6}。
また、五十嵐らもアカイカを対象魚種として同様に幾何平均法でHSIモデルを構築している\cite{a7}。
それらを踏襲し、本研究では幾何平均法を採用する。


\section{SIモデル}
漁獲量を単一の海洋環境変数から説明するモデルがSIモデルである。以下では従来のSIモデル構築手法と提案手法を説明し、その違いを述べる。

\subsection{従来手法によるSIモデル構築}
従来手法でのSIモデル構築は次の手順で行う。
まず、SIモデルを構築したい変数について、深さインデックスを一つ選ぶ。
実測した漁獲点から垂直に見た時の深さインデックスでの変数値と、その漁獲点でのCPUEを散布図に描点する。
次に平滑化パラメータを一つ設定し、散布図を平滑化スプラインで近似する。
深さインデックスの選択と、平滑化パラメータの設定を繰り返し、利用者が最適と判断したスプライン曲線をSIモデルとする。
これを変数ごとに行うことで、各SIモデルを構築する。
この手法でSIモデルを構築する場合、変数値とCPUEの散布図を作成する時点で漁獲を行った時刻の情報が失われる。
そのため、SIモデルの時間変化を考慮することができない。
そこで、SIモデルが変化しないよう短い時間幅でモデルを構築する必要がある。
\if0
散布図の例
\fi
この散布図をスプライン曲線で近似することで、SIモデルを構築する。
\if0
スプライン曲線で近似する方法の説明
\fi
次の変数でも同様に深さインデックスを選び直しスプライン曲線で近似する。
こうすることで5種のSIモデルを構築できる。

\subsection{提案手法によるSIモデル構築}
提案手法でのSIモデルの構築を行う。
本研究で使用する海洋環境変数データは5種の変数、塩分濃度、温度、緯度方向の流速、経度方向の流速、深さ方向の流速からなる。
また各変数は特定の深さごとに値を持っており、それらの線形和を使ってSIモデル構築をする場合、次式で表すことができる。

\begin{eqnarray}
SI = \sum_{i=0}^{depth} a_i x_i
\label{eq:3-1}
\end{eqnarray}

$x_i$ は漁獲点の鉛直方向深さiでの海洋環境変数の値、$a_i$ はその係数である。
さらに過去のデータとして、先に説明した手法で計算した海洋環境変数データを用いると次式でSIモデルを表せる。

\begin{eqnarray}
SI = \sum_{j=0} \sum_{i=0}^{depth} a_ij x_ij
\label{eq:3-5}
\end{eqnarray}

$x_ij$ は漁獲点の鉛直方向の深さiを始点としてj日遡った地点での海洋環境変数の値、$a_ij$ はその係数である。

漁獲点における式(\ref{eq:3-2})と漁獲実績(CPUE)との差、$\delta$ を最小化する $a_k$ を求めることでSIモデルを構築できる。
しかし、このままではオーバーフィッティングの問題が発生する。
\if0
オーバーフィッティングの一般的な説明と、今回のデータでオーバーフィッティングの例を示したい
\fi
そこで罰則項として、$\delta$ に係数 $a_k$ のL0ノルムと重み$\lambda$ の積を加えた次式を考える。

\begin{eqnarray}
\delta = (CPUE - \sum_{k=0}^{depth} a_k x_k ) + \lambda ||\bm{a}||_0
\label{eq:3-2}
\end{eqnarray}

L0ノルムは次式で表せる。

\begin{eqnarray}
 ||\bm{a}||_0 = \sum_{k=0}^{depth} |a_k|^0
\label{eq:3-3}
\end{eqnarray}

$0^0=0$ と定義した場合、式(\ref{eq:3-3})は係数$a_k$ の非ゼロ成分の数となる。
式(\ref{eq:3-2})を最小化する係数$a_k$を最小二乗法で求める。

\section{提案手法を実現するアルゴリズム}
先に述べた計算手法を計算機上で実現するアルゴリズムについて説明する。

\section{IRLS}
IRLSとは
\if0
なぜこのアルゴリズムが変数を減らす方向に働くのか
→まずWを更新する（Wは対角行列でi番目の係数の逆数が入っている）
つぎに係数行列を最小二乗法で解く。（最小二乗法なのでここで最適化計算）
最適化計算の中にWが入っている（Wは係数0で最小になる）
このときに係数が減る
まとめると今回のアルゴリズムは最小化問題を何度も解いて、係数行列が収束したら終わるようになっている
また、各最小化問題は項の中にL0ノルムが入っているので、係数を0にする方向に働く（正則化のwikipediaになぜそう働くのか書いてある）
→最小化計算部分をただの逆行列計算と勘違いしていたからわからなかった
\fi

\section{HSIモデル構築}
先程のSIモデル構築を各海洋環境変数ごとに適用することで、対象魚種にとっての好適な各海洋環境変数がわかる。
それらの相乗平均をHSIモデルとすることで、対象魚種の最適な海洋環境の分布がわかる。
\if0
SIからHSIモデルを求める方法はいくつかある
その中で過去の研究ではなぜ相乗平均だったのか書く
\fi

\begin{eqnarray}
HSI = \sqrt{ \sum SI} = \sqrt{ \sum \sum_{k=0}^{depth} a_k x_k } 
\label{eq:3-4}
\end{eqnarray}

\section{HSIモデルから漁獲量予測への変換}
HSIは0から1に正規化している。
実際の漁獲量予測にするためには
