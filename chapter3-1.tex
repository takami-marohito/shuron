本章では，データの計算法や提案するHSIモデル構築手法及び漁獲モデル構築手法などの基礎技術について述べる．

\section{使用データ}\label{30}
HSI値を求めるためには海洋環境変数データ，対象魚種の漁獲実績データが必要となる．
本研究で使用したこれらのデータについて述べる．

\subsection{海洋環境変数データ}
本研究で使用する海洋環境変数データは，気象庁気象研究所で開発された海洋データ同化システムで作成されたMOVE（MRI Multivariate Ocean Variational Estimation）データである．
この海洋データ同化システムは数値海洋モデル及び同化システムから成るシステムである\cite{a5}．
気象研究所共用海洋モデルMRI.COM\cite{a26}を用いて計算したシミュレーションデータと実測データを同化することでMOVEデータは計算された．
MOVEデータでは海水温，塩分濃度，3次元方向の流速が緯度経度$0.1^\circ$ ごとに計算されている．
また，深さは全54段階で最大6000mまで計算されている．
MOVEデータへのアクセスはOPeNDAPプロトコル\cite{a27}を用いている．
OPeNDAPはHTTP経由でデータアクセスを行うためのプロトコルであり地球科学の分野でよく使われる．
本研究で利用するMOVEデータの場合は変数名，日付番号，深さインデックス，緯度経度の配列範囲を指定しリクエストすることで，緯度経度の配列番号と実際の緯度経度の対応，指定範囲の変数データなどが返ってくる．

\if
海洋環境変数データの説明
変数が5種
深さは54段階
格子の縦横
データがカバーする緯度範囲経度範囲
いつだれがどんな計算機で計算したか
\fi

\subsection{過去のデータの計算}
本研究では過去の海洋環境変数を利用することを提案している．
ある地点での漁獲を過去の海洋環境変数から説明する場合その地点と海洋環境変数の間に時空間的な繋がりがあると考えられる．
そのためその地点の海水がどこから来たものなのか計算し，その経路上でサンプリングした海洋環境変数のみを使用するべきである．
時空間的に無関係な海洋環境変数を使用してそれが漁獲モデルに採用された場合，一般に漁獲モデルの予測精度が悪くなるからである．
\if0
双見君の研究でその必要性を説明している
\fi
本研究で使用する海洋環境データは3次元方向の速度も含んでいるので，ある地点の海水がどこから来たのか遡って計算することができる．
そして当然，漁獲点の緯度経度だけではなく深さごとに異なる速度を持っているので，それぞれの深さをスタート地点として遡ると全く別の地点にたどり着く．
\if0
moveデータのダウンロードの仕様（日にちと深さを指定する）を説明して，遡るために何度もダウンロードする必要があることと，そのために事前計算とするひつようがあることをせつめいする．
\fi
今回はより正確に過去の地点を遡るために４次のルンゲクッタ法を用いた．

\subsection{ルンゲクッタ法}
ルンゲクッタ法は常微分方程式の数値解を求める手法の一種である．
同じように常微分方程式の数値解を求める手法として，オイラー法がある．
海洋環境変数を使用することである地点から流れを遡る場合，その地点の速度にステップの時間幅をかけることで過去の地点を求める手法がオイラー法である（式\ref{eq:3-20}）．

\begin{eqnarray}
\label{eq:3-20}
(x^{(t-1)}, y^{(t-1)}, z^{(t-1)}) = (x^t , y^t , z^t) - (u^t , v^t , w^t) \cdot \Delta t
\end{eqnarray}

遡っているので速度が負になっている．
オイラー法では速度はそのままその地点の速度を用いて，ステップの時間幅で速度変化がないものとして扱っている．
しかし，実際には微小時間ごとに速度変化は起きている．
ルンゲクッタ法はオイラー法の式である式\ref{eq:3-20}における$u^t$と$v^t$と$w^t$をより正確に求める手法である．
そのため，速度変化が一切ない領域ではどちらの手法も同じ結果となるが，本研究で使用する海洋環境変数データはそのような領域は全くないため，ルンゲクッタ法による精度向上が期待できる．

4次のルンゲクッタ法は次のように計算する．

\begin{enumerate}
\item k1からk4を計算する
\item k1からk4を重みを付けて平均化する
\item それを速度としてステップの時間幅$\Delta t$をかけることで，移動量とする
\item もとの位置に移動量を足すことで解とする
\end{enumerate}

k1は式\ref{eq:3-21}で計算する．

\begin{eqnarray}
\label{eq:3-21}
k1 = {\bf f} ({\bf X}, t)
\end{eqnarray}

ただし${bf X} = (x,y,z)$であり，${\bf f} ({\bf X}, t)$は時刻$t$，座標(x,y,z)における速度ベクトルである．

k2は式\ref{eq:3-22}で計算する．

\begin{eqnarray}
\label{eq:3-22}
k2 = {\bf f} ({\bf X} + k1\frac{\Delta t}{2} , t-\frac{\Delta t}{2})
\end{eqnarray}

${bf X} + \frac{\Delta t}{2} k1 = (x + \frac{\Delta t}{2} k1_u ,y+ \frac{\Delta t}{2} k1_v ,z+ \frac{\Delta t}{2} k1_w )$であり，${\bf f} ({\bf X} + \frac{\Delta t}{2} k1, t-\frac{\Delta t}{2})$は時刻$t-\frac{\Delta t}{2}$，座標$ (x + \frac{\Delta t}{2} k1_u ,y+ \frac{\Delta t}{2} k1_v ,z+ \frac{\Delta t}{2} k1_w )$における速度ベクトルである．

k3は式\ref{eq:3-23}で計算する．

\begin{eqnarray}
\label{eq:3-23}
k3 = {\bf f} ({\bf X} + k2\frac{\Delta t}{2} , t-\frac{\Delta t}{2})
\end{eqnarray}

k4は式\ref{eq:3-24}で計算する．

\begin{eqnarray}
\label{eq:3-24}
k4 = {\bf f} ({\bf X} + k3\Delta t , t-\Delta t)
\end{eqnarray}

k1からk4を用いて，ステップ時間前の座標は次式のようになる．

\begin{eqnarray}
\label{eq:3-25}
{\bf X}^{(t-1)} = {\bf X}^{t} - \frac{\Delta t}{6} (k1 + 2k2 + 2k3 + k4)
\end{eqnarray}

本研究ではより正確に流跡線計算を行うために，8時間ごと（一日に3回）にルンゲクッタ法で流跡線計算を行う．
この場合，式\ref{eq:3-22}，式\ref{eq:3-23}，式\ref{eq:3-24}，式\ref{eq:3-25}での$\Delta t$は$\frac{1}{3}$になり，これを3回計算することで一日分の流跡線が計算できる．

このようにして計算した流跡線上で海洋環境変数を一日ごとにサンプリングする．
サンプリングは線形補間で行う．
今回は3次元の座標$(x,y,z)$での海洋環境変数値$P(x,y,z)$を線形補間するので近傍の8点$(X_{i},Y_{i},Z_{i})$，$(X_{i+1},Y_{i},Z_{i})$，$(X_{i},Y_{i+1},Z_{i})$，
$(X_{i+1},Y_{i+1},Z_{i})$，$(X_{i},Y_{i},Z_{i+1})，
(X_{i+1},Y_{i},Z_{i+1})，(X_{i},Y_{i+1},Z_{i+1})，
(X_{i+1},Y_{i+1},Z_{i+1})$とそこでの海洋環境変数値$P(X,Y,Z)$を使って次の式で補間できる．

\begin{eqnarray}
\label{eq:3-99}
P_{y-z-} = P(X_{i},Y_{i},Z_{i}) + \frac{x-X_{i}}{X_{i+1}-X_{i}} \left( P(X_{i+1},Y_{i},Z_{i}) - P(X_{i},Y_{i},Z_{i})\right) \nonumber \\
P_{y+z-} = P(X_{i},Y_{i+1},Z_{i}) + \frac{x-X_{i}}{X_{i+1}-X_{i}} \left( P(X_{i+1},Y_{i+1},Z_{i}) - P(X_{i},Y_{i+1},Z_{i}) \right) \nonumber \\
P_{z-} = P_{y-z-} + \frac{y-Y_{i}}{Y_{i+1}-Y_{i}} \left( P_{y+z-} - P_{y-z-} \right) \nonumber \\
P_{y-z+} = P(X_{i},Y_{i},Z_{i+1}) + \frac{x-X_{i}}{X_{i+1}-X_{i}} \left( P(X_{i+1},Y_{i},Z_{i+1}) - P(X_{i},Y_{i},Z_{i+1})\right) \nonumber \\
P_{y+z+} = P(X_{i},Y_{i+1},Z_{i+1}) + \frac{x-X_{i}}{X_{i+1}-X_{i}} \left( P(X_{i+1},Y_{i+1},Z_{i+1}) - P(X_{i},Y_{i+1},Z_{i+1}) \right) \nonumber \\
P_{z+} = P_{y-z+} + \frac{y-Y_{i}}{Y_{i+1}-Y_{i}} \left( P_{y+z+} - P_{y-z+} \right) \nonumber \\
P(x,y,z) = P_{z-} + \frac{z-Z_{i}}{Z_{i+1}-Z_{i}} \left( P_{z+} - P_{z-} \right) \nonumber 
\end{eqnarray}

ルンゲクッタ法で補間を行う場合はさらに時間の補間も必要となる．
これも先の式と同様にして次式で計算できる．

\begin{eqnarray}
P(x,y,z,t) = P(x,y,z,T_{i}) + \frac{t-T_{i}}{T_{i+1}-T_{i}} \left( P(x,y,z,T_{i+1}) - P(x,y,z,T_{i}) \right)
\end{eqnarray}

このようにして流跡線が計算できる．
流跡線を計算し，可視化した一例が図\ref{fig:3-3}である．

\begin{figure}
  \begin{center}
    \includegraphics[width=13cm]{3-3.png}
  \end{center}
  \caption{ルンゲクッタ法を用いて流跡線計算を行った．その結果の一例として漁獲位置から60日前までの流跡線計算を行い，その流れを可視化した．}
  \label{fig:3-3}
\end{figure}

\subsection{漁獲実績データ}
本研究で使用する漁獲実績データは，日本近海の太平洋沖におけるアカイカの漁獲実績データある．
漁獲実績データには日付，緯度，経度，漁獲量，操業開始時間，操業終了時間，CPUE（Catch Per Unit Effort）値が記録されている．
CPUE値は単位釣り機が単位時間に捕獲したアカイカの重量を表している．
漁船ごとに釣り機の性能や数は異なり，操業を行う人間の釣り機を扱う技能によってもCPUEは変化する．
しかしすべての漁船に搭載される釣り機が同じ性能であり，操業を行う人間の技能も同じであると仮定すると，CPUE値はその海域での魚群の密度を反映する値であるとできる．
このことから，CPUE値は漁場予測において重要な値である．
また，この漁獲実績データは，HSIモデリング結果を可視化する際に漁獲位置をマーキングするためにも使用する．
例えば，太平洋の漁獲実績を基に日本海での漁獲量を予測しようとしても，それぞれの漁獲に関連がないので，有効な予測をすることはできない．
漁獲位置をマーキングすることで，HSIモデリングの有効な範囲を大まかに把握することができる．

\section{HSIモデルから漁獲量予測への変換}
先に説明したようにHSIはその地点が対象生物の生息地として適しているかどうかを0から1で数値化したモデルである．
一方，漁獲量を表すCPUEは単位釣り機が単位時間に捕獲した対象生物の重量である．
生息しやすい環境ではそこに対象生物が集まることや，そこでの対象生物の生存確率が上がることなどが起きるのでそのような環境では対象生物の数が多くなると考えられる．
対象生物の数が多くなると，一般には対象生物のCPUEが高くなる．
そのためHSI値とCPUEが比例関係にあると仮定することで漁獲予測に関する過去の研究が行われてきた．
HSI=0の時は対象生物がおらずCPUE=0となり，HSI=1の時は対象生物が最大数おりCPUE=maxとなるとすると，その変換は式\ref{eq:3-0}で行うことができる．

\begin{eqnarray}
\label{eq:3-0}
PredictedCPUE &=& (maxCPUE-0) \times HSI \\
&=& maxCPUE \times HSI
\end{eqnarray}

PredictedCPUEは漁獲量予測，maxCPUEは観測された最大CPUEである．
本研究ではHSIとCPUEの変換をこの式で行う．
